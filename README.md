# SHOPDESK – MS SQL – Облікова система партнерів. Опис таблиць БД MS SQL

SHOPDESK використовує наступні таблиці:

1. [ARTICL](#articl)
2. [DISCOUNT_RULES](#discount_rules)
3. [IZMER](#izmer)
4. [KAT](#kat)
5. [LIST](#list) (якщо використовується імпорт замовлень постачальнику)
6. [NAKL](#nakl) (якщо використовується імпорт замовлень постачальнику)
7. [POINT](#point)
8. [REESTR](#reestr)
9. [TCU_PAR](#tcu_par)
10. [TEMPLATEDETAILS](#templatedetails) (якщо використовується робота з шаблонами замовлень)
11. [TEMPLATES](#templates) (якщо використовується робота з шаблонами замовлень)
12. [TOVAR](#tovar)
13. [TOVAR_CODE](#tovar_code)
14. [USER](#user)
15. [USER_RIGHTS](#user_rights)

Технічна специфікація до бази даних ТЦУ3 - <https://andriy.co/Tehnicheskaya_spetsifikatsiya_k_baze_dannyh_TCU3.aspx>
Shopdesk не використовує всі поля у цих таблицях. Список полів, що використовуються, можна побачити в базі OfflineDB.mdb (непотрібні поля відсутні)
> [!WARNING]
> По кожній таблиці наводиться не весь список полів, а лише тих, на які слід звернути увагу.


## <a id="articl">ARTICL
Стаття. Може бути по одній на продаж, повернення коштів, інвентаризацію. Для таких видів рекомендується використовувати активні статті.
|**Ім'я поля**|**Тип**|**Опис**|
|:---|:---|:---|
|act_pass|Boolean|False для активних статей|


## <a id="discount_rules">DISCOUNT_RULES
Правила дисконту. Таблиця може бути порожньою. Якщо ви хочете надати клієнту накопичувальну знижку, слід ввести наступні дані:
|**Ім'я поля**|**Тип**|**Опис**|
|:---|:---|:---|
|point_number    |Long   |посилання на ID клієнта \[point\]. \[point_number\]|
|sales_sum		 |Double |сума покупок, накопичена клієнтом за період, в гривнях.|
|sales_period    |Integer|період покупок клієнтом в днях (якщо 0, то накопичувальна знижка застосовується тільки за сумою поточного чеку)|
|discount_percent|Double |відсоток знижки. Може приймати значення від 0 до 1. «1» відповідає 100% знижки.|

**Приклад:**
|point_number|sales_sum|sales_period|discount_percent|Опис|
|:---|:---|:---|:---|:----------------------|
|412|100 |0  |0,1|Знижка 10%, якщо сума поточного чека перевищує 100 грн.|
|412|1000|30 |0,2|Знижка 20%, якщо сума продажів за останні 30 днів + сума поточного чека перевищує 1000 грн|

**Примітка**: Якщо чек відповідає більш ніж одній умові одночасно, надається знижка з найвищим значенням


## <a id="izmer">IZMER
Одиниці вимірювання


## <a id="kat">KAT
Групи товарів
|**Ім'я поля**|**Тип**|**Опис**|
|:---|:---|:---|
|PointsGeneratePercent|Double                 |Коефіцієнт нарахування балів для групи. Наприклад, для алкоголю і сигарет = 0. Для інших товарів =1|
|kat_image            |image<br>(бінарні дані)|Зображення групи товарів. Формат зображення – jpg, png. Розмір - не більше 300 пікселів у висоту або ширину. Зображення буде вписано в елемент інтерфейсу при будь-якому співвідношенні сторін, але для досягнення найкращих результатів використовуйте співвідношення сторін висота/ширина від 0,87 до 1. На зображенні для категорій слід уникати текстів, написів у верхній частині малюнка, так як в інтерфейсі ПЗ касового місця буде накладатися назва групи.|


## <a id="list">LIST
Таблиця товарних записів документа. Посилається на \[Nakl\] за полем \[nakl_number\]
|**Ім'я поля**|**Тип**|**Опис**|
|:---|:---|:---|
|list_number  |Long  |ID запису|
|nakl_number  |Long  |ID документа, що містить цей товарний запис|
|tovar_number |Long  |ID товара з довідника товарів|
|reestr_number|Long  |ID реєстрового запису з таблиці reestr. Може набувати значення 0|
|kol          |Double|Кількість товара в одиницях виміру|
|cena_zak     |Double|Закупівельна ціна товара за одиницю виміру. Може дорівнювати 0 і в цьому випадку касир повинен встановити закупівельні ціни самостійно після імпорту документа. У будь-якому випадку, встановить касир цю ціну чи ні, у бекофісі цю ціну має проконтролювати відповідальний співробітник перед затвердженням прибуткової накладної.|
|cena_rozn    |Double|Роздрібна ціна товара за одиницю виміру. Обов'язкове значення, оскільки касир не має можливості редагувати ці значення. У бекофісі цю ціну має проконтролювати відповідальний співробітник перед затвердженням прибуткової накладної.|


## <a id="nakl">NAKL
Таблиця документів. На неї посилається таблиця товарних записів \[List\] в полі \[nakl_number\]
Таблиці Nakl і List використовуються для зберігання документів «Замовлення постачальнику», з яких на касі створюються прибуткові накладні. Касир має доступ до переліку замовлень постачальнику. При імпорті замовлення відразу ж буде створена прибуткова накладна з повним переліком товарів з цього замовлення.
|**Ім'я поля**|**Тип**|**Опис**|
|:---|:---|:---|
|nakl_number  |Long      |Унікальний номер документа в обліковій системі|
|doc_number   |String 255|Обліковий номер документа, який виводиться на друк|
|point1_number|Long      |Номер торгової точки, на якій створено документ|
|point2_number|Long      |Номер контрагента (постачальника)|
|date_utv     |Date      |дата затвердження документа|
|nakl_type    |Integer   |нумератор типу документа. Для замовлення постачальнику = 19|
|utv          |Boolean   |ознака затвердженого документа. Імпортуються лише затверджені замовлення постачальнику (= True)|
|articl_number|Long      |ідентифікатор статті з таблиці articl|
|sum_opt      |Double    |сума документа у закупівельних цінах|


## <a id="point">POINT
Контрагенти та торгові точки. Обов'язково ввести роздрібного покупця та всі торгові точки. Клієнти системи CRM зберігаються в іншій базі
|**Ім'я поля**|**Тип**|**Опис**|
|:---|:---|:---|
|post                 |Boolean|False – торгова точка, True – контрагенти (покупці, постачальники)|
|discount_card_percent|Double |Розмір знижки. Може набувати значень від 0 до 1. «1» відповідає 100% знижці.|
|card_number          |String |Номер знижкової картки. Опис формату карток знижок - <http://andriy.co/help/diskontnye_karty.aspx>|
|card_activated       |Boolean|True, якщо картка активна|
|discount_type        |Integer|0 – Фіксована знижка<br>1 – Накопичувальна (див. discount_rules)<br>2 – Колонка прайсу 1 (див. tovar.cena_rozn_sprav)<br>3 – Колонка прайсу 2 (див. tovar.cena_rozn2)<br>4 – Колонка прайсу 3 (див. tovar.cena_rozn3)<br>5 – Колонка прайсу 4 (див. tovar.cena_rozn4)<br>6 – Колонка прайсу 5 (див. tovar.cena_rozn5)<br>11 - Колонка прайсу 6 (див. tovar.cena_rozn6)<br>12 - Колонка прайсу 7 (див. tovar.cena_rozn7)<br>13 - Колонка прайсу 8 (див. tovar.cena_rozn8)<br>14 - Колонка прайсу 9 (див. tovar.cena_rozn9)<br>15 - Колонка прайсу 10 (див. tovar.cena_rozn10)<br>16 - Колонка прайсу 11 (див. tovar.cena_rozn11)<br>17 - Колонка прайсу 12 (див. tovar.cena_rozn12)<br>18 - Колонка прайсу 13 (див. tovar.cena_rozn13)<br>19 - Колонка прайсу 14 (див. tovar.cena_rozn14)<br>20 - Колонка прайсу 15 (див. tovar.cena_rozn15)|


## <a id="reestr">REESTR
Залишки товарів та їх роздрібні ціни
|**Ім'я поля**|**Тип**|**Опис**|
|:---|:---|:---|
|SalePricesWithExciseTax|String|Містить список цін продажу з включеним у себе акцизом, розділених точкою з комою. Приклад: 99,75; 105; 115,50; 120,75; 99,75; 84; 94,50.<br>Ці ціни використовуються для продажу акцизних товарів із рекомендованою ціною (нанесеною на упаковку).<br>Обов'язково до таблиці TCU_PAR необхідно прописати розмір акцизної ставки цього товара. Повинен бути рядок із групою, що відповідає податковій ставці товара. Наприклад, товар має податкову групу 1, тому TCU_PAR.param_name = FiscalGroup1TaxValue, TCU_PAR.param_type = 3, TCU_PAR.double_value = 0,05 (відповідає 5%).<br>Група податкової ставки товара вказується у tovar.fiscal_group_number<br>З цін продажу у вищезгаданому списку будуть відніматися ці 5% і ціни без акцизу (ціна без акцизу відповідає ціні, зазначеній на упаковці товара) будуть показані касиру для вибору.|
|QuantityLastModified   |Date  |Дата та час актуальності кількості товара на точці. Часто буває так, що обробка чеків продажу на боці бекофісу та оновлення залишків відбуваються рідше, ніж оновлення цін та залишків на касі. Через це неможливо точно будь-якої миті часу знати залишок товара на точці і, відповідно, контролювати продажі в мінус.<br>При продажах в Shopdesk враховується цей час - від кількості kol віднімаються продажі, створені з моменту, вказаного в QuantityLastModified, додаються повернення і, таким чином, завжди точно відомо актуальну кількість по реєстру, навіть якщо дані про залишки з боку бекофісу оновлюються рідко.|
|kol                    |Double|Кількість товара на певній точці в одиницях виміру. Рекомендується використовувати дату актуальності залишків.|
|point_number           |Long  |ID торгової точки, за якою вказуються реєстрові дані|
|UomScale               |Double|Крок одиниці вимірювання. При продажу товара його кількість перевіряється на кратність цьому значенню. Якщо кількість не кратна, продаж не дозволено. Для штучних товарів слід писати «1» (=1 шт, бут. Уп. тощо), для вагових – «0,001» (=0,001 кг)|


## <a id="tcu_par">TCU_PAR
Параметри програми. Усі значення у цій таблиці опціональні (не обов'язкові).
Якщо використовується фіскальний реєстратор, Shopdesk на робочому місці касира звіряє значення податкових ставок, прописаних в самому пристрої зі значеннями в обліковій системі. Це простий контроль для виключення помилок при визначенні податкових ставок для товарів (див. Tovar.fiscal_group_number), який, однак, не перешкоджає реєстрації продажів навіть за наявності помилок або невказаної податкової ставки. Проте настійно рекомендується для відповідної податкової групи вказати податкову ставку в цій таблиці, щоб на робочому місці касира не з'являлося попередження про розбіжність податкових ставок.
Наприклад, якщо у фіскальному реєстраторі прописано податкову ставку 20% для групи А, то в таблиці tcu_par потрібно створити запис з param_name = FiscalGroup1TaxValue, param_type = 3 і double_value = 0.2
|**param_name**|**param_type**|**text_value**|**bool_value**|**long_value**|**double_value**|
|:--------------------|:--------|:----------|:---|:---|:-----|
|nvarchar(50)        |smallint|nvarchar(255)|bit|Int|Float|
|FiscalGroup1TaxValue|3       |NULL         |0  |0  |0.2|
|FiscalGroup2TaxValue|3       |NULL         |0  |0  |0  |
|FiscalGroup3TaxValue|3       |NULL         |0  |0  |0  |
|FiscalGroup4TaxValue|3       |NULL         |0  |0  |0  |
|FiscalGroup5TaxValue|3       |NULL         |0  |0  |0  |

У цінниках використовують назву компанії. Її можна прописати як параметр під назвою “name_firm”:
|:--------------------|:--------|:----------|:---|:---|:-----|
|name_firm           |0       |Назва вашої компанії|0|0|0|


## <a id="templatedetails">TEMPLATEDETAILS
Таблиця записів товарів, що входять до шаблонів
|**Ім'я поля**|**Тип**|**Опис**|
|:---|:---|:---|
|TemplateDetailId|Int          |ID запису, лічильник, ключове|
|TemplateId      |Int          |посилання на ID шаблону (\[Templates\].TemplateId)|
|DetailId        |Int          |посилання на товар із таблиці товарів (\[tovar\].tovar_number)|
|DetailQuantity  |float        |кількість товара (опціонально). = 0|
|DetailComment   |nvarchar(255)|Коментар до запису товара|

**Примітка:** Видалення записів з таблиці \[Templates\] каскадно видаляє пов'язані записи та з \[TemplateDetails\]


## <a id="templates">TEMPLATES
Таблиця шаблонів замовлень. Заповнюється в першу чергу, оскільки \[TemplateDetails\] має посилання на неї.
Таблиці Templates та TemplateDetails дозволяють зберігати шаблони замовлень зі списком товарів. При виборі одного з цих шаблонів на касі буде створено документ замовлення з повним списком товарів із цього шаблону
|**Ім'я поля**|**Тип**|**Опис**|
|:---|:---|:---|
|TemplateId          |Int          |ID шаблону, лічильник, ключове|
|TemplateDepartmentId|Int          |ID торгової точки, до якої відноситься шаблон|
|TemplateContractorId|Int          |ID контрагента|
|TemplateName        |nvarchar(50) |ім'я шаблону|
|TemplateDescription |nvarchar(255)|додатковий опис до шаблону|


## <a id="tovar_code">TOVAR_CODE
Штрих-коди товарів. Посилаються на таблицю товарів. Для вагових товарів мають бути визначені ШК формату EAN-13 з префіксом 25 (може бути й іншим), та 5 або 6-значним коротким ваговим кодом, який касир набирає на клавіатурі перед зважуванням товара. Наприклад, товар з кодом 12345 повинен мати ваговий штрих-код 2512345000000 (для варіанта «5 цифр коду + 5 цифр ваги») або 2501234500000 (для варіанту «6 цифр коду + 4 цифри ваги»). На місці нулів після коду ваги вказують вагу у грамах. Допустимі формати та префікси вагових ШК вказуються в налаштуваннях Shopdesk.
Докладніше про формат вагових ШК - [Вагові штрих-коди](http://andriy.co/help/vesovye_shtrihkody.aspx).
|**Ім'я поля**|**Тип**|**Опис**|
|:---|:---|:---|
|tovar_number  |Integer|Посилання на товар з таблиці Tovar|
|tovar_bar_code|String |Штрих-код або просто цифровий код товара. Може відповідати формату EAN-13 чи ні, важливо, щоб він був унікальним у цій таблиці. Для вагових штрих-кодів відповідність формату EAN-13 обов'язкова (див. опис формату вагових ШК вище)|


## <a id="user">USER
Користувачі. Тут потрібні лише касири та адміністратор. Спочатку можна ввести касира «каса» без пароля.
Для адміністратора вкажіть наступне:
|**Ім'я поля**|**Тип**|**Опис**|
|:---|:---|:---|
|user_name|String |"Administrator" без лапок|
|passwd   |String |"ver24aa0c758a9b1cf87e71176482d953d62" без лапок|
|admin    |Boolean|True|

Для касира вкажіть наступне:
|**Ім'я поля**|**Тип**|**Опис**|
|:---|:---|:---|
|user_name          |String     |Логін касира, наприклад, «Каса» без лапок|
|passwd             |String     |Можна залишити порожнім, вхід до каси буде без пароля|
|admin              |Boolean    |False|
|cash_report_access |Boolean    |True для можливості отримати доступ до підсумків по касі|
|negative_rests     |Boolean    |True для можливості торгувати в мінус за залишками|
|report_access      |Boolean    |True для можливості отримати доступ до звітів|
|max_discount       |Double     |Максимально можлива знижка, яку касир може надати. Може набувати значень від 0 до 1. «1» відповідає 100% знижці.|
|closed             |Boolean    |Ознака закритого користувача. True – закрито, False – відкрито.|


## <a id="user_rights">USER_RIGHTS
Права користувачів за кожною з торгових точок. Адміністратора можна не прив'язувати до точок.
Касиру треба дозволити редагування та затвердження чека:
|**Ім'я поля**|**Тип**|**Опис**|
|:---|:---|:---|
|00edit   |Boolean|True|
|00approve|Boolean|True|
|04edit   |Boolean|True|
|04approve|Boolean|True|
|07edit   |Boolean|True|
|07approve|Boolean|True|
